---
phase: 03-user-management
plan: 03
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - Frontend/src/Pages/AdminUserDetails.jsx
  - Frontend/src/App.jsx
autonomous: true

must_haves:
  truths:
    - "Admin can view a user's full profile with preference history and meal plans"
    - "Admin can suspend or reactivate a user from the detail view"
    - "User status updates are reflected immediately in the UI"
  artifacts:
    - path: "Frontend/src/Pages/AdminUserDetails.jsx"
      provides: "User detail screen with preferences and plan inspection"
      min_lines: 120
    - path: "Frontend/src/App.jsx"
      provides: "Admin route for /admin/users/:userId"
      contains: "/admin/users"
  key_links:
    - from: "Frontend/src/Pages/AdminUserDetails.jsx"
      to: "/admin/users/{user_id}"
      via: "fetch with Clerk token"
      pattern: "admin/users/"
    - from: "Frontend/src/Pages/AdminUserDetails.jsx"
      to: "/admin/users/{user_id}/status"
      via: "PATCH"
      pattern: "status"
---

<objective>
Create the admin user detail view and connect suspension controls.

Purpose: Let admins inspect full user history and manage account status.
Output: Detail route and page with preference/plan inspection and suspend toggle.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@Frontend/src/App.jsx
@Frontend/src/Pages/AdminUsers.jsx
@Frontend/src/Entities/api.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add user detail route and page shell</name>
  <files>Frontend/src/Pages/AdminUserDetails.jsx, Frontend/src/App.jsx</files>
  <action>
Create `AdminUserDetails.jsx` using `useParams` and Clerk `getToken` to fetch `/admin/users/{userId}`.
Render user profile fields (name, email, signup date, status) and a preferences list.
Add a new admin route in `App.jsx`: `/admin/users/:userId` mapped to the new page.
  </action>
  <verify>Navigate to `/admin/users/{id}` and confirm profile + preference history renders.</verify>
  <done>User detail route loads and displays user info with preference history.</done>
</task>

<task type="auto">
  <name>Task 2: Implement suspend/activate control with immediate refresh</name>
  <files>Frontend/src/Pages/AdminUserDetails.jsx</files>
  <action>
Add a suspend/activate button that calls `PATCH /admin/users/{userId}/status` with the toggled `is_active` value.
Use a confirmation prompt before suspending, then refetch or locally update the user status on success.
Surface request errors inline (same style as AdminDashboard error state).
  </action>
  <verify>Click suspend and confirm the status badge updates without full page reload.</verify>
  <done>Admin can toggle account status and see the updated state immediately.</done>
</task>

</tasks>

<verification>
- Visit `/admin/users/{id}` and verify preference history plus plan payloads display.
- Suspend a user and confirm the status badge flips and subsequent API calls for that user return 403.
</verification>

<success_criteria>
User detail view supports inspection of preferences/meal plans and account status changes.
</success_criteria>

<output>
After completion, create `.planning/phases/03-user-management/03-03-SUMMARY.md`
</output>
