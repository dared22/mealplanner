# Requirements: Meal Planner - Personalized Recommendations

**Defined:** 2026-02-01
**Core Value:** Deliver personalized meal plans that users actually want to cook and eat, while hitting their nutritional targets.

## Milestone v1.1 Requirements

Requirements for personalized recommendation engine milestone.

### Rating System

- [ ] **RATE-01**: User can like or dislike any meal in a generated weekly plan
- [ ] **RATE-02**: Like/dislike buttons appear on each meal card in the plan view
- [ ] **RATE-03**: User's rating is saved immediately when button clicked
- [ ] **RATE-04**: User can change rating (like → dislike or vice versa)
- [ ] **RATE-05**: User can see their rating history (which recipes rated, when)
- [ ] **RATE-06**: System shows progress toward personalized plans (e.g., "7 more ratings to unlock!")

### Meal Plan History

- [ ] **HIST-01**: System tracks which recipes were included in each generated plan
- [ ] **HIST-02**: System tracks when each plan was generated
- [ ] **HIST-03**: System tracks which meal type (breakfast/lunch/dinner) each recipe was assigned to
- [ ] **HIST-04**: User can view their past meal plans

### Constraint Solver

- [ ] **SOLVER-01**: System uses PuLP constraint optimization library for meal plan generation
- [ ] **SOLVER-02**: System decides plan generation method based on rating count: <10 ratings → OpenAI, 10+ ratings → Constraint Solver
- [ ] **SOLVER-03**: Constraint solver optimizes for: user ratings + macro targets + dietary restrictions + variety
- [ ] **SOLVER-04**: Solver generates 21 meals per week (7 days × 3 meals) matching nutrition goals
- [ ] **SOLVER-05**: Solver respects dietary restrictions (vegan, gluten-free, etc.) as hard constraints
- [ ] **SOLVER-06**: Solver prevents duplicate meals within same week
- [ ] **SOLVER-07**: Solver enforces food group diversity across week
- [ ] **SOLVER-08**: Solver completes in <10 seconds or falls back to OpenAI generation
- [ ] **SOLVER-09**: System pre-filters recipe pool to 300-500 candidates before running solver
- [ ] **SOLVER-10**: If solver cannot find feasible solution, system automatically falls back to OpenAI with user ratings as context

### User Interface

- [ ] **UI-01**: User can swap individual meals in generated plan with alternatives
- [ ] **UI-02**: Swap interface shows 3-5 alternative meals matching same meal type and dietary restrictions
- [ ] **UI-03**: User sees optional tooltip/expandable section explaining why meal was recommended
- [ ] **UI-04**: Explainability shows simple reasoning (e.g., "You liked 5 Italian pasta dishes")
- [ ] **UI-05**: User can access explainability by clicking info icon or "Why this meal?" link
- [ ] **UI-06**: Plan view shows whether plan was generated by AI (cold start) or personalized (solver)

### Data Integrity

- [ ] **DATA-01**: Ratings persist across sessions and devices
- [ ] **DATA-02**: Meal plan history is retained for at least 90 days
- [ ] **DATA-03**: Rating changes update recommendations in next plan generation
- [ ] **DATA-04**: System handles concurrent rating submissions from same user gracefully

### Performance

- [ ] **PERF-01**: Rating submission responds in <1 second
- [ ] **PERF-02**: Meal swap loads alternatives in <2 seconds
- [ ] **PERF-03**: Plan generation completes in <15 seconds (including fallback time if needed)
- [ ] **PERF-04**: System logs solver performance metrics (time, feasibility, fallback rate)

## Future Milestones

Deferred to v1.2+ based on scoping discussion.

### Advanced Variety (v1.2)

- **VARIETY-01**: System avoids serving recipes from last 14-21 days (not just current week)
- **VARIETY-02**: System adds diversity bonus to encourage trying new recipes
- **VARIETY-03**: System includes 10-20% "exploration" meals from unrated recipes

### Advanced Feedback (v1.2)

- **FEED-01**: User can rate meals on multiple dimensions (taste, difficulty, time accuracy)
- **FEED-02**: User can mark meals as "cooked" or "skipped"
- **FEED-03**: System tracks actual meal preparation vs planned meals

### Advanced Explainability (v1.3)

- **EXPL-01**: System clusters similar recipes and explains patterns ("You dislike most curry dishes")
- **EXPL-02**: System shows constraint satisfaction visualization (nutrition vs preferences vs variety triangle)
- **EXPL-03**: User can adjust constraint priorities when solver cannot find solution

### Ingredient Optimization (v1.4+)

- **ING-01**: System considers ingredient package sizes when recommending meals
- **ING-02**: System suggests recipes that use up ingredients from previous meals
- **ING-03**: Database includes portion/yield data for recipes

### Seasonal & Contextual (v1.5+)

- **SEAS-01**: System filters recipes by seasonal ingredient availability
- **SEAS-02**: System adjusts recommendations based on local season and region

### Collaborative Filtering (v2.0+)

- **COLLAB-01**: System learns from similar users' preferences (collaborative filtering)
- **COLLAB-02**: System shows "Users like you also enjoyed..." recommendations

## Out of Scope

Explicitly excluded from all milestones.

| Feature | Reason |
|---------|--------|
| Star ratings (1-5 scale) | Research shows users give extremes (1 or 5); binary is more honest and actionable |
| Infinite macro customization | Analysis paralysis; most users don't know optimal macros |
| Real-time regeneration button | Discards learning; treats symptoms not causes; prefer targeted swaps |
| Recipe upload/creation | Quality control nightmare; nutrition data inconsistency; scope creep |
| Social sharing/discovery | Privacy concerns (health data); moderation burden; defer to later |
| Manual macro entry per meal | Creates unsolvable constraints; defeats automation purpose |

## Traceability

Which phases cover which requirements. Updated during roadmap creation.

| Requirement | Phase | Status |
|-------------|-------|--------|
| RATE-01 | Phase 6 | Pending |
| RATE-02 | Phase 6 | Pending |
| RATE-03 | Phase 6 | Pending |
| RATE-04 | Phase 6 | Pending |
| RATE-05 | Phase 6 | Pending |
| RATE-06 | Phase 6 | Pending |
| HIST-01 | Phase 6 | Pending |
| HIST-02 | Phase 6 | Pending |
| HIST-03 | Phase 6 | Pending |
| HIST-04 | Phase 6 | Pending |
| SOLVER-01 | Phase 7 | Complete |
| SOLVER-02 | Phase 7 | Complete |
| SOLVER-03 | Phase 7 | Complete |
| SOLVER-04 | Phase 7 | Complete |
| SOLVER-05 | Phase 7 | Complete |
| SOLVER-06 | Phase 7 | Complete |
| SOLVER-07 | Phase 7 | Complete |
| SOLVER-08 | Phase 7 | Complete |
| SOLVER-09 | Phase 7 | Complete |
| SOLVER-10 | Phase 7 | Complete |
| UI-01 | Phase 8 | Pending |
| UI-02 | Phase 8 | Pending |
| UI-03 | Phase 8 | Pending |
| UI-04 | Phase 8 | Pending |
| UI-05 | Phase 8 | Pending |
| UI-06 | Phase 8 | Pending |
| DATA-01 | Phase 6 | Pending |
| DATA-02 | Phase 8 | Pending |
| DATA-03 | Phase 8 | Pending |
| DATA-04 | Phase 6 | Pending |
| PERF-01 | Phase 6 | Pending |
| PERF-02 | Phase 8 | Pending |
| PERF-03 | Phase 7 | Complete |
| PERF-04 | Phase 7 | Complete |

**Coverage:**
- Milestone v1.1 requirements: 34 total
- Mapped to phases: 34/34
- Unmapped: 0

---
*Requirements defined: 2026-02-01*
*Last updated: 2026-02-01 after roadmap creation*
